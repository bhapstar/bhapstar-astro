<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Primary SEO -->
  <title>Bhapstar Astrophotography — Fragments of the Universe</title>
  <meta name="description" content="Deep-sky astrophotography by Bhapinder (Bobby) Singh. Nebulae, galaxies, star clusters and more — captured through patient long-exposure imaging under dark skies." />
  <meta name="author" content="Bhapinder Singh" />

  <!-- Open Graph (social sharing) -->
  <meta property="og:type"        content="website" />
  <meta property="og:title"       content="Bhapstar Astrophotography — Fragments of the Universe" />
  <meta property="og:description" content="Nebulae, galaxies, star clusters and deep-sky objects — captured slowly through patient hours of long exposure under dark skies." />
  <meta property="og:image"       content="images/RN.jpg" />
  <meta property="og:url"         content="https://bhapstar.com/" />

  <!-- Twitter Card -->
  <meta name="twitter:card"        content="summary_large_image" />
  <meta name="twitter:title"       content="Bhapstar Astrophotography" />
  <meta name="twitter:description" content="Nebulae, galaxies and deep-sky objects captured through patient long-exposure imaging." />
  <meta name="twitter:image"       content="images/RN.jpg" />

  <!-- Google Search Console verification -->
  <meta name="google-site-verification" content="QnMwC-ycqBRx8M1hdYQCTaO02X3GASV9P1Kmmi6QOrI" />

  <!-- Cloudflare Web Analytics -->
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
    data-cf-beacon='{"token":"b3353c7dd8764a64baee57fd09c3dbb9"}'></script>

  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<!-- ── Header (injected by partials.js) ── -->
<div id="siteHeader"></div>

<main>
  <!-- ─────────────────────────────
       HERO
       Full-viewport section with
       background slideshow + star canvas
  ───────────────────────────────── -->
  <section class="hero protect-zone" aria-label="Hero section">

    <!-- Background crossfade layers (JS swaps .is-on class) -->
    <div class="hero-bg" aria-hidden="true">
      <div class="hero-bg-layer layer-a"></div>
      <div class="hero-bg-layer layer-b"></div>
    </div>

    <!-- Foreground content -->
    <div class="content wrap">
      <p class="kicker">Deep-sky astrophotography</p>

      <h1>Fragments of the Universe</h1>
      <h1 class="hero-byline">by Bhapstar Astrophotography</h1>

      <p class="lead">
        Nebulae, galaxies, star clusters and deep-sky objects — captured slowly
        through patient hours of long exposure under dark skies, pulling colour,
        dust and structure from the edge of space.
      </p>

      <div class="actions">
        <a class="btn primary" href="gallery.html">View the gallery</a>
        <a class="btn"         href="prints.html">Print enquiries</a>
      </div>
    </div>

  </section>
</main>

<!-- ── Footer (injected by partials.js) ── -->
<div id="siteFooter"></div>


<!-- ─────────────────────────────────────────
     HERO BACKGROUND SLIDESHOW
     - Fetches gallery-data.json as single source of truth
     - Randomises and cycles images every HOLD_MS
     - Crossfades between two layers (A / B)
     - Preloads upcoming images to avoid stutter
───────────────────────────────────────── -->
<script>
(async function () {
  const layerA = document.querySelector('.hero-bg .layer-a');
  const layerB = document.querySelector('.hero-bg .layer-b');
  if (!layerA || !layerB) return;

  function preload(src) {
    return new Promise((res, rej) => {
      const img = new Image();
      img.onload  = () => res(src);
      img.onerror = () => rej(src);
      img.src = src;
    });
  }

  function shuffle(arr) {
    return arr
      .map(v => ({ v, r: Math.random() }))
      .sort((a, b) => a.r - b.r)
      .map(x => x.v);
  }

  function getCoverFile(item) {
    if (item?.images?.length) return item.images[0].file;
    return item?.file;
  }

  let items = [];
  try {
    const res = await fetch('gallery-data.json', { cache: 'no-store' });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    items = await res.json();
    if (!Array.isArray(items) || !items.length) throw new Error('Empty');
  } catch (e) {
    console.warn('Hero slideshow: could not load gallery data', e);
    return;
  }

  let playlist = shuffle(items.slice());
  let idx = 0;
  const HOLD_MS = 6000;

  function warmPreload() {
    [0, 1, 2].forEach(n => {
      const src = getCoverFile(playlist[(idx + n) % playlist.length]);
      if (src) { const im = new Image(); im.src = src; }
    });
  }

  function setLayer(layer, src) {
    layer.style.backgroundImage = `url("${CSS.escape ? CSS.escape(src).replace(/^#/, '') : src}")`;
    // Simpler, safer version:
    layer.style.backgroundImage = `url("${src}")`;
  }

  // Initial state
  setLayer(layerA, getCoverFile(playlist[idx]));
  layerA.classList.add('is-on');
  warmPreload();

  let onA = true;

  const reduceMotion =
    window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (reduceMotion || playlist.length <= 1) return;

  async function nextSlide() {
    idx = (idx + 1) >= playlist.length ? 0 : idx + 1;
    if (idx === 0) playlist = shuffle(items.slice());

    const nextSrc = getCoverFile(playlist[idx]);
    try { await preload(nextSrc); } catch { return; }

    const incoming = onA ? layerB : layerA;
    const outgoing = onA ? layerA : layerB;

    setLayer(incoming, nextSrc);
    incoming.classList.add('is-on');
    outgoing.classList.remove('is-on');

    onA = !onA;
    warmPreload();
  }

  setInterval(nextSlide, HOLD_MS);
})();
</script>

<script src="protect-images.js"></script>
<script src="partials/partials.js"></script>

</body>
</html>
