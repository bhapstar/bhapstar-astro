<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gallery — bhapstar</title>
  <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "b3353c7dd8764a64baee57fd09c3dbb9"}'></script><!-- End Cloudflare Web Analytics -->
  <link rel="stylesheet" href="styles.css?v=7" />

  <style>
    /* Lightbox */
    .lightbox{
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,.92);
      z-index: 9999;
      padding: 18px;
    }
    .lightbox.open{ display: flex; }

    .lightbox-inner{
      position: relative;
      width: min(1200px, 100%);
      height: min(82vh, 900px);
      border-radius: 16px;
      overflow: hidden;
      background: rgba(0,0,0,.35);
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
    }

    .lightbox-img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none; /* stops direct drag from the image */
    }
    /* Watermark overlay (bottom third) */
    .lightbox-watermark.lightbox-watermark{
      position: absolute;
      inset: 0;                /* fills the entire image */
      display: flex;
      align-items: center;     /* vertical centre */
      justify-content: center; /* horizontal centre */
      pointer-events: none;
    }
    .lightbox-watermark span{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      text-transform: lowercase;
      letter-spacing: .12em;
      font-weight: 700;
      font-size: clamp(40px, 10vw, 120px);
      opacity: .05;          /* <-- adjust watermark strength here */
      color: #fff;
      transform: rotate(-12deg);
      text-shadow: 0 8px 22px rgba(0,0,0,.35);
      mix-blend-mode: screen; /* keeps it light */
      user-select: none;
      white-space: nowrap;
    }

    /* Close button */
    .lightbox-close{
      position: absolute;
      top: 12px;
      right: 12px;
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.35);
      color: #fff;
      display: grid;
      place-items: center;
      cursor: pointer;
      backdrop-filter: blur(6px);
    }
    .lightbox-close:hover{ background: rgba(0,0,0,.55); }

    /* Small caption */
    .lightbox-meta{
      position: absolute;
      left: 14px;
      bottom: 14px;
      right: 14px;
      display: flex;
      gap: 10px;
      align-items: flex-end;
      justify-content: space-between;
      pointer-events: none;
    }
    .lightbox-meta .title{
      font-weight: 650;
      font-size: 14px;
      opacity: .95;
      color: rgba(255,255,255,.92);
      text-shadow: 0 8px 22px rgba(0,0,0,.55);
      max-width: 70%;
      line-height: 1.25;
    }
    .lightbox-meta a{
      pointer-events: auto;
      font-size: 12px;
      opacity: .9;
      color: rgba(255,255,255,.92);
      text-decoration: none;
      border-bottom: 1px solid rgba(255,255,255,.35);
    }
    .lightbox-meta a:hover{ opacity: 1; border-bottom-color: rgba(255,255,255,.75); }

    /* Prevent background scroll when lightbox open */
    body.noscroll{ overflow: hidden; }

    /* Lightbox nav buttons */
    .lightbox-nav{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.35);
      color: #fff;
      display: grid;
      place-items: center;
      cursor: pointer;
      backdrop-filter: blur(6px);
      user-select: none;
    }
    .lightbox-nav:hover{ background: rgba(0,0,0,.55); }

    #lbPrev{ left: 12px; }
    #lbNext{ right: 12px; }

    /* ✅ Multi-image badge on gallery tiles */
    .card{ position: relative; }

    .multi-badge{
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 3;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.45);
      color: rgba(255,255,255,.92);
      font-size: 12px;
      line-height: 1;
      backdrop-filter: blur(6px);
      pointer-events: none;
    }

    .multi-badge .stack{
      width: 12px;
      height: 12px;
      display: inline-block;
      border-radius: 3px;
      box-shadow:
        0 0 0 1px rgba(255,255,255,.28) inset,
        3px 3px 0 0 rgba(255,255,255,.10);
      opacity: .9;
    }
    .lightbox-vid{
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}
/* Video thumbnails in gallery tiles */
.card video{
  width: 100%;
  height: auto;
  display: block;
  border-radius: 12px;
  object-fit: cover;
}

  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="navbar">
      <div></div>

      <a class="brand" href="index.html" aria-label="bhapstar home">
        <span class="mark">bhapstar</span>
        <span class="sub">astrophotography</span>
      </a>

      <button class="burger" aria-label="Menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <nav class="nav-menu" aria-label="Site">
        <a href="index.html">Home</a>
        <a class="active" href="gallery.html">Gallery</a>
        <a href="prints.html">Prints</a>
        <a href="gear.html">Gear</a>
        <a href="about.html">About</a>
      </nav>
    </div>
  </div>
</header>

<main>
<section class="section">
<div class="wrap">

  <div class="section-head gallery-head">
    <div class="gallery-topline">
      <h2>Gallery</h2>
    </div>

    <p class="gallery-intro">
      All images shown here are my own, created through patient hours of long-exposure imaging under dark, often cold night skies, followed by careful processing to reveal faint structures and subtle detail hidden in the data.
    </p>

    <div class="gallery-filter" role="group" aria-label="Gallery filter">
      <label class="gallery-filter-label" for="typeFilter">View gallery images by type</label>

      <div class="gallery-filter-row">
        <select id="typeFilter" class="gallery-filter-select">
  <option value="all">All</option>
  <option value="galaxies">Galaxies</option>
  <option value="nebulae">Nebulae</option>
  <option value="star-clusters">Star Clusters</option>
  <option value="star-trails">Star Trails</option>
  <option value="others">Others</option>
</select>
        <div class="gallery-filter-spacer"></div>
        <button id="viewToggle" class="view-toggle" type="button" aria-pressed="false">
          List view
        </button>
      </div>
    </div>

    <p class="gallery-hint">
      Click any image to view fullscreen.
    </p>
  </div>

  <!-- THIS must be outside the section-head -->
  <div id="galleryGrid" class="grid"></div>

</div>
</section>
</main>

<footer>
  <div class="wrap">
    <div class="footer-links">
      <span>© <span id="y"></span> bhapstar astrophotography</span>
      <span>·</span>
      <a href="gallery.html">Gallery</a>
      <span>·</span>
      <a href="prints.html">Prints</a>
      <span>·</span>
      <a href="gear.html">Gear</a>
      <span>·</span>
      <a href="about.html">About</a>

      <a href="https://www.instagram.com/bhapstar/"
         target="_blank"
         rel="noopener"
         aria-label="Instagram"
         class="social-icon">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <rect x="2" y="2" width="20" height="20" rx="5"
                stroke="currentColor" stroke-width="2"/>
          <circle cx="12" cy="12" r="5"
                  stroke="currentColor" stroke-width="2"/>
          <circle cx="17.5" cy="6.5" r="1.2"
                  fill="currentColor"/>
        </svg>
      </a>
    </div>
  </div>
</footer>
<script>(function(){var y=document.getElementById('y'); if(y) y.textContent=new Date().getFullYear();})();</script>

<script>
(function(){
  const burger = document.querySelector('.burger');
  const menu = document.querySelector('.nav-menu');
  if(!burger || !menu) return;

  burger.addEventListener('click', () => {
    const open = menu.classList.toggle('open');
    burger.setAttribute('aria-expanded', open ? 'true' : 'false');
  });

  document.addEventListener('click', (e) => {
    if(menu.classList.contains('open') && !menu.contains(e.target) && !burger.contains(e.target)){
      menu.classList.remove('open');
      burger.setAttribute('aria-expanded','false');
    }
  });

  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape'){
      menu.classList.remove('open');
      burger.setAttribute('aria-expanded','false');
    }
  });
})();
</script>

<!-- Embedded gallery data -->
<script id="galleryData" type="application/json">
[
  {
    "file": "images/RN.jpg",
    "title": "Rosette Nebula (NGC 2244)",
    "desc": "A vast, expanding cloud of ionised hydrogen surrounding a young open star cluster at its core. Intense radiation from newly formed stars carves cavities into the surrounding gas, revealing the fragile balance between stellar birth and destruction.",
    "alt": "Rosette Nebula",
    "type": "nebulae"
  },
  {
    "file": "images/JFN.jpg",
    "title": "Jellyfish Nebula (IC 443)",
    "desc": "The remnants of a massive stellar explosion, where an expanding supernova shockwave collides with surrounding molecular clouds. Filamentary structures trace the violence of the event, frozen in motion thousands of years after the star’s death.",
    "alt": "Jellyfish Nebula",
    "type": "nebulae"
  },
  {
    "file": "images/Xmas.jpg",
    "title": "Christmas Tree Nebula (NGC 2264)",
    "desc": "A rich and chaotic star-forming region where glowing emission nebulae intertwine with dense, cold dust. The Cone Nebula stands as a towering pillar of molecular gas, sculpted by ultraviolet radiation from nearby massive stars.",
    "alt": "NGC 2264 (Cone Nebula & Christmas Tree)",
    "type": "nebulae"
  },
  {
    "file": "images/MHN.jpg",
    "title": "Monkey Head Nebula (NGC 2174)",
    "desc": "A luminous star-forming region shaped by powerful radiation and stellar winds from young, massive stars. Dark dust lanes cut through glowing hydrogen, giving rise to the nebula’s distinctive silhouette against the Orion constellation.",
    "alt": "Monkey Head Nebula",
    "type": "nebulae"
  },
  {
    "file": "images/Pleiades.jpeg",
    "title": "Pleiades (M45)",
    "desc": "A young open star cluster dominated by hot, blue stars, drifting through faint interstellar dust that reflects their light. Often mistaken for a nebula, the delicate blue haze is a foreground veil rather than material born with the stars themselves.",
    "alt": "Pleiades star cluster",
    "type": "star-clusters"
  },
  {
    "file": "images/Orion Nebula.jpg",
    "title": "Orion Nebula (M42)",
    "desc": "The closest large star-forming region to Earth, glowing just below Orion’s Belt. Visible to the naked eye, this vast stellar nursery offers a rare glimpse into the processes that give rise to new stars and planetary systems.",
    "alt": "The Orion Nebula",
    "type": "nebulae"
  },
  {
    "file": "images/Andromeda.jpg",
    "title": "Andromeda Galaxy (M31)",
    "desc": "A vast spiral galaxy beyond our own, captured as its ancient light travels over two million years through intergalactic space. A reminder that the Milky Way is not alone, but one of countless island universes drifting through the dark.",
    "alt": "Andromeda",
    "type": "galaxies"
  },
  {
    "file": "images/Flame&Horsehead.jpg",
    "title": "Flame (NGC 2024) and Horsehead (B33) Nebulae",
    "desc": "Dark molecular dust and glowing hydrogen clouds shaped by intense radiation from nearby young stars, suspended along the edge of Orion’s Belt. A region where star formation, erosion, and shadow coexist in delicate balance.",
    "alt": "Flame&Horsehead",
    "type": "nebulae"
  },
  {
    "file": "images/Eagle Nebula.jpeg",
    "title": "Eagle Nebula (M16)",
    "desc": "A vast stellar nursery where dense clouds of gas and dust give rise to new generations of stars. The iconic Pillars of Creation rise from the nebula’s core, slowly eroded by radiation from the young stars forming within",
    "alt": "The Eagle Nebula",
    "type": "nebulae"
  },
  {
    "file": "images/Bodes & Cigar.jpeg",
    "title": "Bode's (M81) and Cigar (M82) Galaxies",
    "desc": "A closely interacting pair of galaxies in Ursa Major, their gravitational encounter leaving lasting marks on both systems. While M81 retains its elegant spiral structure, M82 shows intense starburst activity triggered by their past interaction.",
    "alt": "Bodes & Cigar",
    "type": "galaxies"
  },
  {
    "file": "images/Triangulum.jpg",
    "title": "Triangulum Galaxy (M33)",
    "desc": "A nearby spiral galaxy in the Local Group, smaller and more diffuse than the Milky Way. Its faint arms are rich with glowing star-forming regions, scattered across a delicate and expansive disk.",
    "alt": "Triangulum",
    "type": "galaxies"
  },
    {
    "file": "images/Moon.jpeg",
    "title": "The Moon",
    "desc": "Earth’s only natural satellite, its heavily cratered surface shaped by billions of years of impacts and geological change. Seen here in fine detail, it serves as both a familiar presence and a reminder of our planet’s place in space.",
    "alt": "The Moon",
    "type": "others"
  },
  {
    "images": [
      { "file": "images/MilkyWay&Me.jpg",  "alt": "Milky Way and me (1)" },
      { "file": "images/MilkyWay&Me2.jpg", "alt": "Milky Way and me (2)" },
      { "file": "images/MilkyWay&Me3.jpg", "alt": "Milky Way and me (3)" },
      { "file": "images/MilkyWay&Me4.jpg", "alt": "Milky Way and me (4)" }
    ],
    "title": "The Milky Way and Me",
    "desc": "Some quiet moments for me beneath the arc of the Milky Way, standing against the glowing structure of our home galaxy. A human scale set against cosmic distances, where Earth becomes part of the wider scene rather than its centre.",
    "type": "others"
  },
  {
    "images": [
      { "file": "images/Geminids_Composite.jpg",  "alt": "Geminids Meteor Shower Composite" },
      { "file": "images/Geminids_Composite_Labelled.jpg", "alt": "Geminids Meteor Shower Composite Labelled" }
    ],
    "title": "The Geminids Meteor Shower",
    "desc": "An annual meteor shower caused by debris from asteroid 3200 Phaethon. This composite records multiple Geminid meteors over a single night, tracing their apparent paths back to the constellation Gemini as Earth passes through the stream.",
    "type": "others"
  },
{
  "images": [
    { "file": "images/startrails-1.jpg", "alt": "Star trails still 1" },
    { "file": "images/startrails-2.jpg", "alt": "Star trails still 2" },
    { "file": "images/startrails-3.jpg", "alt": "Star trails still 3" },
    { "file": "images/startrails-4.jpg", "alt": "Star trails still 4" }
  ],
  "title": "Star Trails (Stills)",
  "desc": "Four stills from star-trails sessions.",
  "type": "star-trails"
},
{
  "videos": [
    { "vimeoId": "1162067160", "poster": "images/startrails-1.jpg", "alt": "Star trails video 1" },
    { "vimeoId": "1162067172", "poster": "images/startrails-2.jpg", "alt": "Star trails video 2" },
    { "vimeoId": "1162067196", "poster": "images/startrails-3.jpg", "alt": "Star trails video 3" },
    { "vimeoId": "1162067206", "poster": "images/startrails-4.jpg", "alt": "Star trails video 4" }
  ],
  "title": "Star Trails (Videos)",
  "desc": "Four short star-trails clips from a single session.",
  "type": "star-trails"
}


]
</script>

<!-- Lightbox markup -->
<div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="Image viewer">
  <div class="lightbox-inner">
    <button class="lightbox-close" id="lbClose" aria-label="Close">✕</button>

    <button class="lightbox-nav" id="lbPrev" aria-label="Previous image">‹</button>
    <button class="lightbox-nav" id="lbNext" aria-label="Next image">›</button>

    <img class="lightbox-img" id="lbImg" alt="" src="" />
   <div class="lightbox-vid" id="lbVid" style="display:none; width:100%; height:100%;"></div>

    <div class="lightbox-watermark" aria-hidden="true"><span>bhapstar</span></div>

    <div class="lightbox-meta" aria-hidden="false">
      <div class="title" id="lbTitle"></div>
      <div class="count" id="lbCount"></div>
    </div>
  </div>
</div>

<script>
(function(){
  const grid = document.getElementById('galleryGrid');
  const dataEl = document.getElementById('galleryData');

  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lbImg');
  const lbVid = document.getElementById('lbVid');   // ✅ missing in your version
  const lbTitle = document.getElementById('lbTitle');
  const lbCount = document.getElementById('lbCount');
  const lbClose = document.getElementById('lbClose');
  const lbPrev = document.getElementById('lbPrev');
  const lbNext = document.getElementById('lbNext');

  const typeFilter = document.getElementById('typeFilter');
  const viewToggle = document.getElementById('viewToggle');

  if(!grid || !dataEl || !lb || !lbImg || !lbTitle || !lbClose) return;

  let items = [];
  try{
    items = JSON.parse(dataEl.textContent);
  }catch(err){
    console.error("Gallery JSON parse error:", err);
    grid.innerHTML = `<div style="padding:18px;opacity:.8">Gallery data error (JSON). Check for stray commas.</div>`;
    return;
  }

  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function isVideoFile(path){
    return /\.mp4(\?|#|$)/i.test(path || "");
  }

function getList(item){
  // Vimeo stack
  if(item.videos && Array.isArray(item.videos) && item.videos.length){
    return item.videos.map(v => ({
      kind: "vimeo",
      vimeoId: v.vimeoId,
      poster: v.poster,
      alt: v.alt || item.title || ""
    }));
  }

  // Image stack
  if(item.images && Array.isArray(item.images) && item.images.length){
    return item.images.map(im => ({
      kind: "image",
      file: im.file,
      alt: im.alt || item.alt || item.title || ""
    }));
  }

  // Single file (image)
  return [{
    kind: "image",
    file: item.file,
    alt: item.alt || item.title || ""
  }];
}


function getCover(item){
  const list = getList(item);
  const first = list[0];

  // For Vimeo tiles, use poster as cover
  if(first && first.kind === "vimeo"){
    return { file: first.poster, alt: first.alt || item.title || "" };
  }
  return { file: first.file, alt: first.alt || item.title || "" };
}


  let currentItem = null;
  let lbList = [];
  let lbIndex = 0;

function showLb(){
  const cur = lbList[lbIndex];

  lbTitle.textContent = currentItem?.title || "";
  if(lbCount){
    lbCount.textContent = lbList.length > 1 ? `${lbIndex + 1} / ${lbList.length}` : "";
  }

  const multi = lbList.length > 1;
  if(lbPrev) lbPrev.style.display = multi ? "" : "none";
  if(lbNext) lbNext.style.display = multi ? "" : "none";

  // reset
  lbImg.style.display = "none";
  lbImg.src = "";
  lbImg.alt = "";

  if(lbVid){
    lbVid.style.display = "none";
    lbVid.innerHTML = "";
  }

  if(cur.kind === "vimeo"){
    // Vimeo embed
    if(lbVid){
      lbVid.style.display = "block";
      const id = encodeURIComponent(cur.vimeoId);
      lbVid.innerHTML = `
        <iframe
          src="https://player.vimeo.com/video/${id}?autoplay=1&title=0&byline=0&portrait=0"
          frameborder="0"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          style="width:100%;height:100%">
        </iframe>
      `;
    }
    return;
  }

  // Image
  lbImg.style.display = "block";
  lbImg.src = cur.file;
  lbImg.alt = cur.alt || (currentItem?.title || "");
}


  function openLightbox(item){
    currentItem = item;
    lbList = getList(item);
    lbIndex = 0;
    showLb();

    lb.classList.add('open');
    lb.setAttribute('aria-hidden','false');
    document.body.classList.add('noscroll');
  }

  function closeLightbox(){
    lb.classList.remove('open');
    lb.setAttribute('aria-hidden','true');
    document.body.classList.remove('noscroll');

if(lbVid){
  lbVid.innerHTML = "";      // kills iframe playback
  lbVid.style.display = "none";
}


    lbImg.src = "";
    lbImg.alt = "";
    lbImg.style.display = "block";
    lbTitle.textContent = "";
    if(lbCount) lbCount.textContent = "";

    currentItem = null;
    lbList = [];
    lbIndex = 0;
  }

  function render(){
    const selected = (typeFilter && typeFilter.value) ? typeFilter.value : 'all';
    const filtered = (selected === 'all')
      ? items
      : items.filter(it => (it.type || 'others') === selected);

    grid.innerHTML = filtered.map((item) => {
      const idx = items.indexOf(item);
      const cover = getCover(item);
      const list = getList(item);
      const count = list.length;

      const badge = count > 1
        ? `<span class="multi-badge" aria-hidden="true"><span class="stack"></span>${count}</span>`
        : '';

const media = isVideoFile(cover.file)
  ? `<video src="${esc(cover.file)}" muted playsinline preload="metadata"></video>`
  : `<img src="${esc(cover.file)}" alt="${esc(cover.alt)}" loading="lazy">`;


      return `
        <a class="card" href="${esc(cover.file)}" data-idx="${idx}" aria-label="${esc(item.title || cover.alt)}">
          ${badge}
          ${media}
          <div class="cap">
            <div class="t">${esc(item.title || "")}</div>
            <div class="d">${esc(item.desc || "")}</div>
          </div>
        </a>
      `;
    }).join('');
  }

  // ✅ Mobile: always grid view
  const isMobile = window.matchMedia('(max-width: 720px)').matches;

  if(isMobile){
    grid.classList.remove('list-view');
    localStorage.setItem('galleryView', 'grid');
    if(viewToggle){
      viewToggle.textContent = 'List view';
      viewToggle.setAttribute('aria-pressed','false');
    }
  } else {
    const savedView = localStorage.getItem('galleryView');
    if(savedView === 'list'){
      grid.classList.add('list-view');
      if(viewToggle){
        viewToggle.textContent = 'Grid view';
        viewToggle.setAttribute('aria-pressed','true');
      }
    } else {
      grid.classList.remove('list-view');
      if(viewToggle){
        viewToggle.textContent = 'List view';
        viewToggle.setAttribute('aria-pressed','false');
      }
    }
  }

  render();

  if(typeFilter){
    typeFilter.addEventListener('change', render);
  }

  if(viewToggle){
    viewToggle.addEventListener('click', () => {
      if(window.matchMedia('(max-width: 720px)').matches) return;

      const isList = grid.classList.toggle('list-view');
      viewToggle.textContent = isList ? 'Grid view' : 'List view';
      viewToggle.setAttribute('aria-pressed', isList ? 'true' : 'false');
      localStorage.setItem('galleryView', isList ? 'list' : 'grid');
    });
  }

  grid.addEventListener('click', (e) => {
    const a = e.target.closest('a.card');
    if(!a) return;
    e.preventDefault();

    const idx = Number(a.getAttribute('data-idx'));
    const item = items[idx];
    if(item) openLightbox(item);
  });

  if(lbClose) lbClose.addEventListener('click', closeLightbox);

  if(lbPrev){
    lbPrev.addEventListener('click', (e) => {
      e.stopPropagation();
      if(lbList.length < 2) return;
      lbIndex = (lbIndex - 1 + lbList.length) % lbList.length;
      showLb();
    });
  }

  if(lbNext){
    lbNext.addEventListener('click', (e) => {
      e.stopPropagation();
      if(lbList.length < 2) return;
      lbIndex = (lbIndex + 1) % lbList.length;
      showLb();
    });
  }

  lb.addEventListener('click', (e) => {
    if(e.target === lb) closeLightbox();
  });

  document.addEventListener('keydown', (e) => {
    if(!lb.classList.contains('open')) return;

    if(e.key === 'Escape') closeLightbox();
    if(e.key === 'ArrowLeft' && lbList.length > 1){
      lbIndex = (lbIndex - 1 + lbList.length) % lbList.length;
      showLb();
    }
    if(e.key === 'ArrowRight' && lbList.length > 1){
      lbIndex = (lbIndex + 1) % lbList.length;
      showLb();
    }
  });
})();
</script>


<script>
/* Scroll reveal (adds "in" when elements enter viewport) */
(function(){
  const els = Array.from(document.querySelectorAll('.section, .panel, .card'))
    .filter(el => !el.classList.contains('reveal'));

  els.forEach(el => el.classList.add('reveal'));

  if(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches){
    els.forEach(el => el.classList.add('in'));
    return;
  }

  const io = new IntersectionObserver((entries) => {
    entries.forEach(en => {
      if(en.isIntersecting){
        en.target.classList.add('in');
        io.unobserve(en.target);
      }
    });
  }, { threshold: 0.12, rootMargin: '0px 0px -8% 0px' });

  els.forEach(el => io.observe(el));
})();
</script>

<script src="protect-images.js"></script>
</body>
</html>
